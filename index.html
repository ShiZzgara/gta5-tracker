<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ä–ª –£—Ä–±–∞–Ω ‚Äî GTA 5 RP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 16px; background: #f0f2f5; color: #000; }
        .header { text-align: center; margin-bottom: 20px; }
        .tabs { display: flex; gap: 4px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 10px; background: #d0d0d0; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; }
        .tab.active { background: #007AFF; color: white; }
        .screen { display: none; }
        .screen.active { display: block; }
        .task-item { display: flex; justify-content: space-between; align-items: center; padding: 14px; background: white; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .task-left { display: flex; align-items: center; gap: 12px; flex: 1; }
        .task-checkbox { width: 24px; height: 24px; cursor: pointer; }
        .task-info { display: flex; flex-direction: column; flex: 1; }
        .task-name { font-weight: 500; }
        .task-count { font-size: 12px; color: #666; }
        .task-points { font-weight: 600; color: #007AFF; margin-right: 10px; }
        .timer-item { display: flex; justify-content: space-between; align-items: center; padding: 14px; background: white; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .timer-name { font-weight: 500; }
        .timer-display { display: flex; flex-direction: column; align-items: flex-end; }
        .timer-time { font-weight: 600; margin-bottom: 4px; }
        .timer-progress { width: 100px; height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden; margin-bottom: 5px; }
        .timer-progress-bar { height: 100%; background: #007AFF; width: 0%; transition: width 0.3s; }
        .btn { background: #007AFF; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; margin: 2px; }
        .btn-reset { background: #ff6b6b; }
        .status { text-align: center; margin: 10px 0; font-size: 14px; color: #666; }
    </style>
</head>
<body>

<div class="header">
    <h1>üë§ –ö–∞—Ä–ª –£—Ä–±–∞–Ω</h1>
</div>

<div class="tabs">
    <button class="tab active" data-screen="tasks">–ó–∞–¥–∞–Ω–∏—è</button>
    <button class="tab" data-screen="timers">–¢–∞–π–º–µ—Ä—ã</button>
</div>

<div class="status" id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<div id="tasks" class="screen active">
    <div id="tasks-container"></div>
    <button class="btn" onclick="resetAll()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
</div>

<div id="timers" class="screen">
    <div id="timers-container"></div>
</div>

<script>
    const API_URL = '/api/data';
    let tasks = {};
    let timers = {};
    let intervals = {};

    const TASKS = [
        { id: 1, name: "–õ–æ—Ç–µ—Ä–µ—è", points: 2 },
        { id: 2, name: "–°–∞–π—Ç", points: 2 },
        { id: 3, name: "–ë—Ä–∞–≤–ª", points: 2 },
        { id: 4, name: "–õ–∞–π–∫ –≤ match", points: 2 },
        { id: 5, name: "–ö–∏–Ω—É—Ç—å –º—è—á–∏–∫", points: 4, desc: "15 —Ä–∞–∑", max: 15, hasCount: true },
        { id: 6, name: "–î—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–∞", points: 4, max: 15, hasCount: true },
        { id: 7, name: "–¢–∏—Ä", points: 2 },
        { id: 8, name: "–°—Ç–∞–≤–∫–∞ –≤ –∫–æ–ª–µ—Å–µ", points: 6, desc: "100 —Ñ–∏—à–µ–∫" },
        { id: 9, name: "–†—ã–±–∞–ª–∫–∞", points: 8, desc: "20 —Ä—ã–±" },
        { id: 10, name: "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å", points: 2, desc: "—Å–≤–æ—é –º–∞—à–∏–Ω—É" },
        { id: 11, name: "–ê—Ä–º—Ä–µ—Å–ª–∏–Ω–≥", points: 2 },
        { id: 12, name: "–ë–∞—Å–∫–µ—Ç–±–æ–ª", points: 2, desc: "2 –º—è—á–∞" },
        { id: 13, name: "–§—É—Ç–±–æ–ª", points: 2, desc: "2 –º—è—á–∞" },
        { id: 14, name: "–ó–∞–¥–∞–Ω–∏—è –∫–ª—É–±–∞", points: 8, max: 2, hasCount: true },
        { id: 15, name: "–î–∞—Ä—Ç—Å", points: 2 },
        { id: 16, name: "–í–æ–ª–µ–π–±–æ–ª", points: 2, desc: "1 –º–∏–Ω—É—Ç–∞" },
        { id: 17, name: "–ü–∏–Ω–≥-–ø–æ–Ω–≥", points: 2, desc: "1 –º–∏–Ω—É—Ç–∞" },
        { id: 18, name: "–¢–µ–Ω–Ω–∏—Å", points: 2, desc: "1 –º–∏–Ω—É—Ç–∞" },
        { id: 19, name: "–°—ã–≥—Ä–∞—Ç—å –≤ –º–∞—Ñ–∏—é", points: 6 },
        { id: 20, name: "–ü–ª–∞—Ç–µ–∂ –ø–æ –ª–∏–∑–∏–Ω–≥—É", points: 2 },
        { id: 21, name: "–ì–æ–Ω–∫–∞", points: 2, desc: "—Å—Ç–∞–≤–∫–∞ 1000" },
        { id: 22, name: "–ê—Ä–µ–Ω–∞", points: 2, max: 3, desc: "–ø–æ–±–µ–¥–∞", hasCount: true },
        { id: 23, name: "–°—Ç—Ä–æ–π–∫–∞", points: 4, desc: "25 –¥–µ–π—Å—Ç–≤–∏–π" },
        { id: 24, name: "–ü–æ—Ä—Ç", points: 4, desc: "25 –¥–µ–π—Å—Ç–≤–∏–π" },
        { id: 25, name: "–®–∞—Ö—Ç–∞", points: 4, desc: "25 –¥–µ–π—Å—Ç–≤–∏–π" },
        { id: 26, name: "–§–µ—Ä–º–∞", points: 2, desc: "10 –¥–µ–π—Å—Ç–≤–∏–π" },
        { id: 27, name: "–ö–∞—Ä—Ç–∏–Ω–≥", points: 2, desc: "–ø–æ–±–µ–¥–∞" },
        { id: 28, name: "–°–æ–∫—Ä–æ–≤–∏—â–µ", points: 2 },
        { id: 29, name: "–ê–≤—Ç–æ–±—É—Å", points: 4, max: 2, hasCount: true },
        { id: 30, name: "–ü–æ—á—Ç–∞", points: 2, max: 10, hasCount: true },
        { id: 31, name: "–ù—É–ª–∏ –≤ –∫–∞–∑–∏–Ω–æ", points: 4 },
        { id: 32, name: "–¢—Ä–µ–Ω–∞–∂–µ—Ä–∫–∞", points: 2, desc: "20 –¥–µ–π—Å—Ç–≤–∏–π" },
        { id: 33, name: "–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å", points: 2, max: 5, desc: "–ø–æ–±–µ–¥—ã –æ—Ç 100$", hasCount: true },
        { id: 34, name: "–®–∫—É—Ä—ã", points: 4, max: 5, desc: "100 –∫–∞—á–µ—Å—Ç–≤–æ", hasCount: true },
        { id: 35, name: "–ü–æ–∂–∞—Ä–Ω—ã–π", points: 2, max: 25, hasCount: true },
        { id: 36, name: "–î–∞–ª—å–Ω–æ–±–æ–π—â–∏–∫", points: 4, max: 3, hasCount: true },
        { id: 37, name: "–ö–∏–Ω–æ—Å—Ç—É–¥–∏—è", points: 4 },
        { id: 38, name: "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä", points: 2, desc: "–∑–∞–≥—Ä—É–∑–∏—Ç—å 5 —Ä–æ–ª–∏–∫–æ–≤" },
        { id: 39, name: "–ú–µ—Ç—Ä–æ", points: 4 },
        { id: 40, name: "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å", points: 4, desc: "–º–∞—à–∏–Ω—É –¥—Ä—É–≥–∞" }
    ];

    const TIMERS = [
        { name: "–î—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–∞", duration: 15 * 60 },
        { name: "–ü–æ—á—Ç–∞", duration: 10 * 60 },
        { name: "–†–µ–¥–Ω–µ–∫–∏", duration: 2 * 60 * 60 },
        { name: "–ö–∞—Ä–º–∏—Ç", duration: 2 * 60 * 60 },
        { name: "–¢–∏—Ä", duration: 90 * 60 }
    ];

    async function api(method, body = {}) {
        const res = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ method, ...body })
        });
        if (!res.ok) throw new Error('API error');
        return await res.json();
    }

    async function load() {
        try {
            const res = await fetch(API_URL);
            if (!res.ok) throw new Error('Load error');
            const data = await res.json();
            tasks = data.tasks || {};
            timers = data.timers || {};
            document.getElementById('status').textContent = '';
            renderAll();
            startTimers();
        } catch (e) {
            console.error(e);
            document.getElementById('status').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
        }
    }

    function startTimers() {
        Object.values(intervals).forEach(clearInterval);
        intervals = {};

        TIMERS.forEach(t => {
            const state = timers[t.name] || { active: false, startedAt: 0 };
            if (state.active && state.startedAt) {
                intervals[t.name] = setInterval(() => renderTimers(), 1000);
            }
        });
    }

    function fmt(sec) {
        sec = Math.max(0, sec);
        return `${Math.floor(sec/60).toString().padStart(2,'0')}:${(sec%60).toString().padStart(2,'0')}`;
    }

    function renderTasks() {
        const c = document.getElementById('tasks-container');
        c.innerHTML = '';
        TASKS.forEach(t => {
            const s = tasks[t.id] || { completed: false, count: 0 };
            const ct = t.hasCount ? ` (${s.count}/${t.max})` : '';
            const ds = t.desc ? ` - ${t.desc}` : '';
            c.innerHTML += `
                <div class="task-item">
                    <div class="task-left">
                        <input type="checkbox" class="task-checkbox" ${s.completed ? 'checked' : ''} onchange="toggleTask(${t.id})">
                        <div class="task-info">
                            <div class="task-name">${t.name}${ct}</div>
                            ${ds ? `<div class="task-count">${ds}</div>` : ''}
                        </div>
                        <div class="task-points">+${t.points}</div>
                    </div>
                    ${t.hasCount ? `<button class="btn btn-reset" onclick="resetTask(${t.id})">‚Ü∫</button>` : ''}
                </div>
            `;
        });
    }

    function renderTimers() {
        const c = document.getElementById('timers-container');
        c.innerHTML = '';
        TIMERS.forEach(t => {
            const s = timers[t.name] || { active: false, startedAt: 0 };
            const now = Date.now();
            const elapsed = s.startedAt ? Math.floor((now - s.startedAt) / 1000) : 0;
            const remaining = Math.max(0, t.duration - elapsed);
            const progress = s.startedAt ? Math.min(100, (elapsed / t.duration) * 100) : 0;
            c.innerHTML += `
                <div class="timer-item">
                    <div class="timer-name">${t.name}</div>
                    <div class="timer-display">
                        <div class="timer-time">${fmt(remaining)}</div>
                        <div class="timer-progress">
                            <div class="timer-progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <button class="btn" onclick="toggleTimer('${t.name}')">${s.active ? '–°—Ç–æ–ø' : '–°—Ç–∞—Ä—Ç'}</button>
                        <button class="btn btn-reset" onclick="resetTimer('${t.name}')">–°–±—Ä–æ—Å</button>
                    </div>
                </div>
            `;
        });
    }

    function renderAll() {
        renderTasks();
        renderTimers();
    }

    async function toggleTask(id) {
        const t = TASKS.find(x => x.id === id);
        const s = tasks[id] || { completed: false, count: 0 };
        let comp = !s.completed;
        let cnt = s.count;
        if (t.hasCount) {
            if (!s.completed) {
                cnt++;
                comp = cnt >= t.max;
            }
        }
        await api('updateTask', { taskId: id, completed: comp, count: cnt });
        await load();
    }

    async function resetTask(id) {
        await api('updateTask', { taskId: id, completed: false, count: 0 });
        await load();
    }

    async function resetAll() {
        if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è?')) return;
        await api('resetTasks');
        await load();
    }

    async function toggleTimer(name) {
        const s = timers[name] || { active: false };
        if (s.active) {
            await api('stopTimer', { timerName: name });
        } else {
            await api('startTimer', { timerName: name });
        }
        await load();
    }

    async function resetTimer(name) {
        await api('resetTimer', { timerName: name });
        await load();
    }

    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.screen).classList.add('active');
        });
    });

    window.toggleTask = toggleTask;
    window.resetTask = resetTask;
    window.resetAll = resetAll;
    window.toggleTimer = toggleTimer;
    window.resetTimer = resetTimer;

    load();
</script>

</body>
</html>
